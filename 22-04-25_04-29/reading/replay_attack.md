# **리플레이 공격**

**리플레이 공격(Replay Attack)**이란 공격자가 보안 네트워크 통신을 가로채고, 해당 통신의 수신자로 하여금 공격자가 원하는 일을 수행하도록 하기 위해 통신을 지연시키거나 재전송하는 방식입니다. 리플레이 공격은 해커가 네트워크에서 메시지를 가로챈 후 메시지를 복호화하기 위한 별도의 과정이 필요하지 않으며, 메시지를 포함한 통신 전체를 다시 전송하는 것으로도 공격을 성공할 수 있습니다.

![xACYgSMwO_7qg2aqQQwOp-1636275204055.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f7a57bd5-08e2-4cea-8960-f29b3916c19d/xACYgSMwO_7qg2aqQQwOp-1636275204055.png)

## **리플레이 공격 동작방식**

예를 들어, 앨리스가 밥에게 100 달러를 송금해달라고 요청하려고 합니다. 앨리스는 밥에게 이 요청을 하기 위해 밥에게 메시지를 보낼 것입니다. 밥은 앨리스를 신뢰하기 때문에 앨리스에게 100달러를 송금합니다.

그런데, 만약 앨리스가 요청을 보냈을 때 공격자가 앨리스의 요청을 가로채어 밥에게 메시지를 다시 보낼 수도 있습니다. 공격자는 앨리스인척 "412-123-90으로 100달러를 보내세요"라는 요청을 밥에게 전달합니다.

밥은 앨리스로부터 왔다고 생각하는 요청 "412-123-90으로 100달러를 보내세요"를 확인하고 412-123-90으로 100달러를 송금합니다. 그러나 이번에는 앨리스가 아닌 공격자에게 돈이 전달됩니다.

## **암호화폐에서 리플레이 공격이 위험한 이유**

블록체인에서 하드 포크가 진행되면, 이전 장부는 소프트웨어의 이전 버전과 새로 업데이트 된 버전으로 나누어져 분할됩니다. 원장만을 업그레이드하기 위한 하드 포크도 있지만, 완전히 새로운 암호화폐를 발행하는 하드 포크도 있습니다. 후자의 경우, 가장 잘 알려진 사례로는 2017년 8월 비트코인으로부터 하드 포크 된 비트코인 캐시가 있습니다.

블록체인에서 리플레이 공격은 하드 포크 시 포크 이전에 생긴 트랜잭션 데이터를 포크 이후 블록체인에 그대로 복사하고 재전송하여 동일한 트랜잭션이 두 번 발생하도록 하는 것입니다.

예를 들어, 이더리움 하드 포크 이전에 앨리스가 밥에게 100ETC를 밥에게 팔았습니다. 그리고 이더리움 하드 포크 이후 앨리스에게 갑자기 100ETC가 사라졌습니다. 하드 포크가 진행되면서 포크 이후에 앨리스가 밥에게 100ETC를 보낸 트랜잭션이 다시 생성되면서 똑같은 트랜잭션이 두 번 일어나게 된 것입니다. 이는 하드 포크 이전에 발생한 트랜잭션은 하드 포크 이후 새롭게 생성된 블록체인에서도 유효하기 때문에 가능합니다.

## **리플레이 공격 대안**

### **세션 식별자 추가**

통신 당사자 간 일회용 토큰을 해싱한 값을 공유하여 리플레이 어택을 피합니다.

1. 앨리스가 밥에게 일회용 토큰을 보냅니다.
2. 밥은 토큰을 암호화하여 앨리스에게 보냅니다.
3. 앨리스는 밥과 동일한 방식으로 토큰을 암호화하고, 그 값이 밥으로부터 받은 값과 같은 경우, 통신을 진행합니다.
4. 공격자가 이 암호화된 값을 가로채고 다른 통신에서 사용하려고 해도, 앨리스가 밥에게 다른 일회용 토큰을 보내면 다른 암호화된 값이 나올 것이기 때문에 공격자가 가로챈 값은 사용할 수 없게 됩니다.

### **일회용 비밀번호**

아주 짧은 세션 시간을 가진 비밀번호를 두 통신 당사자가 공유하여, 공격자가 가로채 재사용하지 못하도록 합니다.

### **타임 스탬프**

앨리스가 네트워크에 시간을 MAC와 함께 브로드캐스트합니다. 밥은 앨리스에게 통신을 요청할 때, 자신의 통신 메시지에 앨리스가 브로드캐스트한 시간을 기준으로 예상 시간을 포함시켜 인증을 진행합니다. 앨리스는 타임 스탬프가 예상 시간 범위 내에 있는 메시지만 수락합니다.